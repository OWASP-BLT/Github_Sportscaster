<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Activity Sportscaster</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .stats {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        /* Sportscaster Announcement Section */
        .sportscaster-section {
            max-width: 900px;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 20px;
            border: 3px solid rgba(255, 215, 0, 0.6);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
        }

        .robot-container {
            flex-shrink: 0;
            width: 120px;
            height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .robot-svg {
            width: 100%;
            height: 100%;
        }

        @keyframes robot-talk {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.7); }
        }

        .robot-mouth {
            animation: robot-talk 0.3s ease-in-out infinite;
            transform-origin: center;
        }

        @keyframes robot-blink {
            0%, 90%, 100% { transform: scaleY(1); }
            95% { transform: scaleY(0.1); }
        }

        .robot-eye {
            animation: robot-blink 3s ease-in-out infinite;
            transform-origin: center;
        }

        @keyframes antenna-glow {
            0%, 100% { fill: #ff4444; filter: drop-shadow(0 0 5px #ff4444); }
            50% { fill: #ffff00; filter: drop-shadow(0 0 10px #ffff00); }
        }

        .antenna-light {
            animation: antenna-glow 1s ease-in-out infinite;
        }

        .tv-screen {
            flex-grow: 1;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 15px;
            padding: 20px;
            border: 4px solid #333;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5), 0 0 15px rgba(100, 100, 255, 0.3);
            position: relative;
            overflow: hidden;
            min-height: 120px;
        }

        .tv-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.1) 0px,
                rgba(0, 0, 0, 0.1) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
        }

        .tv-label {
            position: absolute;
            top: 8px;
            left: 12px;
            font-size: 0.7em;
            color: #ff4444;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        @keyframes live-pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #ff4444;
            border-radius: 50%;
            margin-right: 5px;
            animation: live-pulse 1s ease-in-out infinite;
        }

        .announcement-content {
            margin-top: 15px;
        }

        .announcement-event-type {
            font-size: 0.9em;
            color: #ffd700;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .announcement-repo {
            font-size: 1.4em;
            font-weight: bold;
            color: #fff;
            word-break: break-all;
        }

        .announcement-repo a {
            color: #fff;
            text-decoration: none;
        }

        .announcement-repo a:hover {
            text-decoration: underline;
            color: #ffd700;
        }

        .announcement-time {
            font-size: 0.8em;
            color: #888;
            margin-top: 8px;
        }

        .no-announcement {
            color: #888;
            font-style: italic;
            text-align: center;
            padding: 20px;
        }

        /* Event List Section */
        .list-container {
            max-width: 900px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .event-item {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px 20px;
            transition: all 0.3s ease;
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .event-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            border-color: rgba(255, 215, 0, 0.5);
        }

        .event-number {
            background: rgba(255, 255, 255, 0.2);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9em;
            flex-shrink: 0;
        }

        .event-details {
            flex-grow: 1;
            min-width: 0;
        }

        .event-repo-name {
            font-size: 1.1em;
            font-weight: bold;
            word-break: break-all;
        }

        .event-repo-name a {
            color: #fff;
            text-decoration: none;
        }

        .event-repo-name a:hover {
            text-decoration: underline;
            color: #ffd700;
        }

        .event-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
            flex-wrap: wrap;
        }

        .event-type {
            display: inline-block;
            background: rgba(255, 255, 255, 0.2);
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.75em;
        }

        .event-time {
            font-size: 0.8em;
            opacity: 0.7;
        }

        /* Slide in animation for new events */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .event-item.new-event {
            animation: slideIn 0.4s ease-out;
            border-color: rgba(255, 215, 0, 0.8);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
        }

        /* Blink animation for new activity */
        @keyframes blink {
            0%, 100% { 
                background: rgba(255, 255, 255, 0.1);
                border-color: rgba(255, 255, 255, 0.2);
            }
            50% { 
                background: rgba(255, 215, 0, 0.4);
                border-color: rgba(255, 215, 0, 0.8);
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            }
        }

        .blink {
            animation: blink 0.6s ease-in-out 2;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.5em;
        }

        .error {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #ff6b6b;
        }

        /* Pulse animation for loading */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 1.5s ease-in-out infinite;
        }

        .refresh-info {
            text-align: center;
            margin-top: 20px;
            opacity: 0.8;
            font-size: 0.9em;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .sportscaster-section {
                flex-direction: column;
                text-align: center;
            }

            .robot-container {
                width: 80px;
                height: 100px;
            }

            .tv-screen {
                width: 100%;
            }

            .announcement-repo {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>âš¡ GitHub Activity Sportscaster</h1>
        <p>Real-time feed of GitHub repository activity</p>
    </div>

    <div class="stats">
        <span id="event-count">0</span> events processed | 
        Last update: <span id="last-update">-</span>
    </div>

    <!-- Sportscaster Announcement Section -->
    <div class="sportscaster-section" id="sportscaster">
        <div class="robot-container">
            <svg class="robot-svg" viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
                <!-- Antenna -->
                <line x1="50" y1="10" x2="50" y2="25" stroke="#888" stroke-width="3"/>
                <circle class="antenna-light" cx="50" cy="7" r="5" fill="#ff4444"/>
                
                <!-- Head -->
                <rect x="20" y="25" width="60" height="45" rx="10" fill="#4a5568" stroke="#2d3748" stroke-width="2"/>
                
                <!-- Eyes -->
                <g class="robot-eye">
                    <circle cx="35" cy="45" r="8" fill="#1a202c"/>
                    <circle cx="35" cy="45" r="5" fill="#48bb78"/>
                    <circle cx="37" cy="43" r="2" fill="#fff"/>
                </g>
                <g class="robot-eye">
                    <circle cx="65" cy="45" r="8" fill="#1a202c"/>
                    <circle cx="65" cy="45" r="5" fill="#48bb78"/>
                    <circle cx="67" cy="43" r="2" fill="#fff"/>
                </g>
                
                <!-- Mouth/Speaker -->
                <g class="robot-mouth">
                    <rect x="35" y="58" width="30" height="8" rx="2" fill="#1a202c"/>
                    <line x1="40" y1="62" x2="45" y2="62" stroke="#48bb78" stroke-width="2"/>
                    <line x1="48" y1="62" x2="53" y2="62" stroke="#48bb78" stroke-width="2"/>
                    <line x1="56" y1="62" x2="61" y2="62" stroke="#48bb78" stroke-width="2"/>
                </g>
                
                <!-- Neck -->
                <rect x="40" y="70" width="20" height="10" fill="#718096"/>
                
                <!-- Body -->
                <rect x="15" y="80" width="70" height="35" rx="8" fill="#4a5568" stroke="#2d3748" stroke-width="2"/>
                
                <!-- Chest display -->
                <rect x="30" y="88" width="40" height="20" rx="3" fill="#1a202c"/>
                <text x="50" y="102" text-anchor="middle" fill="#48bb78" font-size="8" font-family="monospace">LIVE</text>
                
                <!-- Arms -->
                <rect x="5" y="82" width="10" height="25" rx="5" fill="#718096"/>
                <rect x="85" y="82" width="10" height="25" rx="5" fill="#718096"/>
            </svg>
        </div>
        <div class="tv-screen">
            <div class="tv-label"><span class="live-indicator"></span>LIVE</div>
            <div class="announcement-content" id="announcement">
                <div class="no-announcement">Waiting for activity...</div>
            </div>
        </div>
    </div>

    <div class="loading pulse" id="loading">Loading GitHub activity...</div>
    <div class="error" id="error" style="display: none;"></div>
    
    <div class="list-container" id="event-list"></div>

    <div class="refresh-info">
        Auto-refreshing every 30 seconds
    </div>

    <script>
        class GitHubSportscaster {
            constructor() {
                this.events = [];
                this.maxEvents = 50; // Keep last 50 events
                this.totalEvents = 0;
                this.updateInterval = 30000; // 30 seconds
                this.demoMode = false;
                this.failedAttempts = 0;
                this.seenEventIds = new Set();
                this.latestEvent = null;
                this.init();
            }

            async init() {
                await this.fetchActivity();
                setInterval(() => this.fetchActivity(), this.updateInterval);
            }

            generateMockEvent(repoName, eventType) {
                const id = Math.floor(Math.random() * 1000000000) + Date.now();
                return {
                    id: id.toString(),
                    repo: {
                        id: Math.floor(Math.random() * 1000000),
                        name: repoName
                    },
                    type: eventType,
                    created_at: new Date().toISOString()
                };
            }

            getMockEvents() {
                const repos = [
                    'facebook/react', 'microsoft/vscode', 'vercel/next.js', 
                    'nodejs/node', 'tensorflow/tensorflow', 'kubernetes/kubernetes',
                    'rust-lang/rust', 'golang/go', 'python/cpython', 
                    'microsoft/TypeScript', 'angular/angular', 'vuejs/vue',
                    'torvalds/linux', 'electron/electron', 'webpack/webpack'
                ];
                const eventTypes = [
                    'PushEvent', 'PullRequestEvent', 'IssuesEvent', 
                    'WatchEvent', 'ForkEvent', 'CreateEvent'
                ];
                
                const events = [];
                // Generate random events for demo
                const count = Math.floor(Math.random() * 5) + 3; // 3-7 new events each time
                for (let i = 0; i < count; i++) {
                    const randomRepo = repos[Math.floor(Math.random() * repos.length)];
                    const randomType = eventTypes[Math.floor(Math.random() * eventTypes.length)];
                    events.push(this.generateMockEvent(randomRepo, randomType));
                }
                return events;
            }

            async fetchActivity() {
                try {
                    let events;
                    
                    if (this.demoMode) {
                        // In demo mode, generate mock events
                        events = this.getMockEvents();
                    } else {
                        // Try to fetch from GitHub API
                        const response = await fetch('https://api.github.com/events');
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        events = await response.json();
                        this.failedAttempts = 0;
                    }

                    this.processEvents(events);
                    this.render();
                    
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('error').style.display = 'none';
                    
                } catch (error) {
                    console.error('Error fetching GitHub events:', error);
                    this.failedAttempts++;
                    
                    // After 2 failed attempts, switch to demo mode
                    if (this.failedAttempts >= 2 && !this.demoMode) {
                        this.demoMode = true;
                        console.log('Switching to demo mode with mock data');
                        const errorDiv = document.getElementById('error');
                        errorDiv.textContent = 'Running in demo mode with simulated data';
                        errorDiv.style.display = 'block';
                        setTimeout(() => {
                            errorDiv.style.display = 'none';
                        }, 3000);
                        // Immediately fetch mock data
                        return this.fetchActivity();
                    }
                    
                    const errorDiv = document.getElementById('error');
                    errorDiv.textContent = `Error loading data: ${error.message}. Retrying...`;
                    errorDiv.style.display = 'block';
                }
            }

            processEvents(events) {
                const newEvents = [];

                // Process each event and collect new ones
                events.forEach(event => {
                    // Validate event structure before processing
                    if (!event || !event.id || !event.repo || !event.repo.name || !event.type || !event.created_at) {
                        return;
                    }

                    const eventId = event.id;
                    
                    // Skip if we've already seen this event
                    if (this.seenEventIds.has(eventId)) {
                        return;
                    }

                    this.seenEventIds.add(eventId);
                    
                    const processedEvent = {
                        id: eventId,
                        repoName: event.repo.name,
                        repoUrl: `https://github.com/${event.repo.name}`,
                        eventType: event.type,
                        createdAt: new Date(event.created_at),
                        isNew: true
                    };

                    newEvents.push(processedEvent);
                    this.totalEvents++;
                });

                // Sort new events by date (newest first)
                newEvents.sort((a, b) => b.createdAt - a.createdAt);

                // Add new events to the front of the list
                this.events = [...newEvents, ...this.events];

                // Keep only the last maxEvents
                if (this.events.length > this.maxEvents) {
                    this.events = this.events.slice(0, this.maxEvents);
                }

                // Update latest event for announcement
                if (newEvents.length > 0) {
                    this.latestEvent = newEvents[0];
                }

                // Store new event IDs for animation
                this.newEventIds = new Set(newEvents.map(e => e.id));

                // Update stats
                document.getElementById('event-count').textContent = this.totalEvents;
                document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
            }

            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            formatEventType(type) {
                return type.replace('Event', '').replace(/([A-Z])/g, ' $1').trim();
            }

            formatTime(date) {
                const now = new Date();
                const diff = Math.floor((now - date) / 1000);
                
                if (diff < 60) return `${diff}s ago`;
                if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
                if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
                return `${Math.floor(diff / 86400)}d ago`;
            }

            updateAnnouncement() {
                const announcementDiv = document.getElementById('announcement');
                
                if (!this.latestEvent) {
                    announcementDiv.innerHTML = '<div class="no-announcement">Waiting for activity...</div>';
                    return;
                }

                const event = this.latestEvent;
                announcementDiv.innerHTML = `
                    <div class="announcement-event-type">${this.escapeHtml(this.formatEventType(event.eventType))}</div>
                    <div class="announcement-repo">
                        <a href="${this.escapeHtml(event.repoUrl)}" target="_blank" rel="noopener noreferrer">${this.escapeHtml(event.repoName)}</a>
                    </div>
                    <div class="announcement-time">${this.escapeHtml(this.formatTime(event.createdAt))}</div>
                `;
            }

            render() {
                const listContainer = document.getElementById('event-list');
                
                // Update sportscaster announcement
                this.updateAnnouncement();
                
                // Clear existing content
                listContainer.innerHTML = '';

                this.events.forEach((event, index) => {
                    const isNew = this.newEventIds && this.newEventIds.has(event.id);

                    const item = document.createElement('div');
                    item.className = 'event-item';
                    item.id = `event-${event.id}`;

                    if (isNew) {
                        item.classList.add('new-event');
                    }

                    item.innerHTML = `
                        <div class="event-number">${index + 1}</div>
                        <div class="event-details">
                            <div class="event-repo-name">
                                <a href="${this.escapeHtml(event.repoUrl)}" target="_blank" rel="noopener noreferrer">${this.escapeHtml(event.repoName)}</a>
                            </div>
                            <div class="event-meta">
                                <span class="event-type">${this.escapeHtml(this.formatEventType(event.eventType))}</span>
                                <span class="event-time">${this.escapeHtml(this.formatTime(event.createdAt))}</span>
                            </div>
                        </div>
                    `;

                    listContainer.appendChild(item);
                });

                // Clear new event markers after render
                this.newEventIds = new Set();
                
                // Mark all events as not new after render
                this.events.forEach(e => e.isNew = false);
            }
        }

        // Initialize the sportscaster when page loads
        window.addEventListener('DOMContentLoaded', () => {
            new GitHubSportscaster();
        });
    </script>
</body>
</html>
